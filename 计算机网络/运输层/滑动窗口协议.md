# 滑动窗口协议

滑动窗口协议允许发送方在停止并等待确认前发送多个数据分组。由于发送方不必每发一个分组就停下来等待确认，因此该协议可以加速数据的传输，提高网络吞吐量。

# GBN（Go-Back-N）

回退N步协议，允许发送方发送多个分组而不需要等待确认（不需要停等）；但是在流水线中未确认的分组数不能超过某个最大的允许数N；N即为窗口长度。

![](http://oss.xiefeng.tech/img/20210701192440.png)

**基序号（send_base）：**最早发送确未确认的分组号

**下一个序列号（nextseqnum）：**最小的未使用的序号（即下一个代发分组的序号）

序号范围：

1. [ 0 , send_base - 1 ] ：已经发送并确认的分组序号
2. [ send_base , nextseqnum - 1 ] ：已发送未确认的分组序号
3. [ nextseqnum , send_base + N - 1 ] ：可以用于立即发送的分组序号
4. [ send_base + N , Infinity ) ：不能使用的分组序号，直到send_base已确认，才可以向后滑动窗口

**发送方响应的事件：**

1. 上层的调用：对于上层的调用，窗口未满就发送否则就等待；
2. 收到一个ACK：对于确认，GBN使用**累积确认**机制；
3. 超时事件：如果出现超时，GBN重传所有已发送还未被确认的分组（名字的由来）

**对于接收方：**

正确有序收到分组即发送一个ACK，并且将数据交付上层，其他情况则丢弃分组，并返回最近按序正确收到的分组的ACK；

**缺点：**

重传了许多不必要的分组

# SR（Selective Repeat）

选择重传，仅重传那些它怀疑在接收方出错（丢失或受损）的分组而避免不必要的重传；

![](http://oss.xiefeng.tech/img/20210701192443.png)

SR接收方将确认一个正确接收的分组（不管是否按序），失序的分组将被缓存直到前面的丢失分组都被收到；这样就可以一起交付给上层；

**发送方的事件：**

1. 从上次收到数据
2. 超时
3. 收到ACK

每个分组都需要有自己的定时器，超时只能发送一个分组

收到的ack如果等于send_base 就滑动窗口；否则就标记分组

**接收方的事件：**

1. 正确接收到分组，就返回ACK，如果之前没有接受过即缓存，接受过则丢弃
2. 对于[rcv_base + N , Infinity ) 的分组，丢弃也不返回

**对于SR协议，窗口长度必须小y于等于序列号空间大小的一半。**